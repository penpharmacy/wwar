<!doctype html>
<html lang="th">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏≤ Warfarin ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏û‡∏∏‡∏ô‡∏û‡∏¥‡∏ô</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#E3F2FD; --card:#fff; --accent:#4CAF50; --muted:#607D8B; --pink:#FFEBEE;
      font-family: 'Kanit', sans-serif;
    }
    body{background:linear-gradient(180deg,var(--bg),#fff);margin:0;padding:20px;color:#263238}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px;text-align:center;flex:1}
    .container{max-width:980px;margin:20px auto}
    .card{background:var(--card);border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.06);padding:18px;margin-bottom:16px}
    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
    input[type=number]{width:100%;padding:10px;border-radius:8px;border:1px solid #eee;font-size:16px}
    .row{display:flex;gap:12px}
    .col{flex:1}
    .radio-row{display:flex;gap:12px;flex-wrap:wrap}
    .pill{padding:10px 14px;border-radius:18px;border:1px solid #eee;background:#fafafa}
    button.primary{background:var(--accent);color:#fff;border:0;padding:12px 18px;border-radius:10px;font-weight:600}
    .result{margin-top:12px}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #f0f0f0;text-align:center}
    .small{font-size:13px;color:var(--muted)}
    .note{background:#FFF8E1;padding:8px;border-radius:8px;margin-top:8px;white-space:pre-line;}
    footer{font-size:13px;color:var(--muted);text-align:center;padding:8px}
    @media(max-width:720px){.row{flex-direction:column}}
  </style>
</head>
<body>
<div class="container">
  <header class="card" style="align-items:center">
    <h1>‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏≤ Warfarin ‡πÇ‡∏£‡∏á‡∏û‡∏¢‡∏≤‡∏ö‡∏≤‡∏•‡∏û‡∏∏‡∏ô‡∏û‡∏¥‡∏ô</h1>
  </header>

  <section class="card">
    <form id="form">
      <div class="row">
        <div class="col">
          <label>INR ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</label>
          <input type="number" step="0.01" id="inr" min="0" value="2.5" required>
        </div>
        <div class="col">
          <label>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤ Warfarin ‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (mg)</label>
          <input type="number" step="0.1" id="weeklyDose" min="0" value="35" required>
        </div>
        <div class="col">
          <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡∏î (‡∏ß‡∏±‡∏ô)</label>
          <input type="number" id="days" min="1" value="7" required>
        </div>
      </div>

      <div style="margin-top:12px">
        <label>‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏°‡πá‡∏î‡∏¢‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ</label>
        <div class="radio-row">
          <label class="pill"><input type="radio" name="pills" value="3" checked> ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡πá‡∏î 3 mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</label>
          <label class="pill"><input type="radio" name="pills" value="2"> ‡πÉ‡∏ä‡πâ‡πÄ‡∏°‡πá‡∏î 2 mg ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</label>
          <label class="pill"><input type="radio" name="pills" value="both"> ‡πÉ‡∏ä‡πâ‡∏ó‡∏±‡πâ‡∏á 2 ‡πÅ‡∏•‡∏∞ 3 mg</label>
        </div>
      </div>

      <div style="margin-top:12px">
        <label>‡∏†‡∏≤‡∏ß‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å</label>
        <div class="radio-row">
          <label class="pill"><input type="radio" name="bleed" value="no" checked> ‡πÑ‡∏°‡πà‡∏°‡∏µ</label>
          <label class="pill"><input type="radio" name="bleed" value="yes"> ‡∏°‡∏µ</label>
        </div>
      </div>
    </form>

    <div id="results" class="result" style="display:none"></div>
  </section>

  <section id="tables" class="card" style="display:none">
    <h3>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏¢‡∏≤ (7 ‡∏ß‡∏±‡∏ô)</h3>
    <div id="plans"></div>
    <div id="summary"></div>
    <div style="margin-top:12px;text-align:right">
      <button onclick="window.print()" class="primary">‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î / ‡∏û‡∏¥‡∏°‡∏û‡πå (PDF)</button>
    </div>
  </section>

  <footer class="card small">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô: ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏°‡∏∑‡∏≠‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤ ‡πÄ‡πÄ‡∏û‡∏ó‡∏¢‡πå/‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏ï‡∏±‡∏î‡∏™‡∏¥‡∏ô‡πÉ‡∏à‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢</footer>
  <!-- ‡∏ï‡∏±‡∏ß‡∏ô‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏° -->
<div class="card small" id="visitorCounter" style="text-align:center; margin-top:12px;">
  ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°...
</div>

<script>
// -------------------- ‡∏ô‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡∏î‡πâ‡∏ß‡∏¢ CountAPI --------------------
const namespace = 'warfarin_hosp';
const key = 'visit_count';

fetch(`https://api.countapi.xyz/hit/${namespace}/${key}`)
  .then(res => res.json())
  .then(data => {
    document.getElementById('visitorCounter').innerText = `‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${data.value} üéâ`;
  })
  .catch(err => {
    console.log(err);
    document.getElementById('visitorCounter').innerText = '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏ä‡∏°‡πÑ‡∏î‡πâ';
  });
</script>
</div>

<script>
function roundHalf(x){return Math.round(x*2)/2}
function distributeEvenly(totalHalfUnits, days){
  const base = Math.floor(totalHalfUnits/days);
  let arr = Array(days).fill(base);
  let rem = totalHalfUnits - base*days;
  for(let i=0;i<rem;i++) arr[i]++;
  return arr;
}
function findBestCombo(target){
  if(target % 5 === 0){
    let num5 = target / 5;
    if(num5 <=7){
      return {h3:num5*2,h2:num5*2,total:num5*5};
    }
    const sets = Math.floor(num5 / 4);
    const rem = num5 % 4;
    const h3 = sets*4 + Math.min(rem*2, rem*2);
    const h2 = sets*4 + Math.max(0, rem*2 - h3);
    return {h3:h3,h2:h2,total:target};
  }
  let best = null;
  let max5 = Math.floor(target / 5);
  for(let n5=max5;n5>=0;n5--){
    let rem = target - n5*5;
    let n3 = Math.floor(rem / 3);
    let n2 = Math.round((rem - n3*3)/2);
    if(n3 + n2 === 0) continue;
    let total = n5*5 + n3*3 + n2*2;
    let diff = Math.abs(total - target);
    if(!best || diff < Math.abs(best.total - target)){
      best = {h3: n5*2 + n3*2, h2: n5*2 + n2*2, total: total};
    }
    if(diff < 0.01) break;
  }
  return best;
}
function buildPlanHTML(title, combo){
  const h3 = combo.h3; const h2 = combo.h2; const total = combo.total;
  const perDay3 = distributeEvenly(h3,7);
  const perDay2 = distributeEvenly(h2,7);
  let html = `<h4>${title} ‚Äî ‡∏£‡∏ß‡∏° ${total.toFixed(1)} mg/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</h4>`;
  html += `<table><thead><tr><th>‡∏ß‡∏±‡∏ô</th><th>3 mg (‡πÄ‡∏°‡πá‡∏î)</th><th>2 mg (‡πÄ‡∏°‡πá‡∏î)</th><th>‡∏£‡∏ß‡∏° (mg)</th></tr></thead><tbody>`;
  const dayNames = ['‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå','‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£','‡∏û‡∏∏‡∏ò','‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ','‡∏®‡∏∏‡∏Å‡∏£‡πå','‡πÄ‡∏™‡∏≤‡∏£‡πå','‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå'];
  for(let i=0;i<7;i++){
    const t3 = perDay3[i]/2;
    const t2 = perDay2[i]/2;
    const mg = t3*3 + t2*2;
    html += `<tr><td>${dayNames[i]}</td><td>${t3 % 1 === 0 ? t3 : t3.toFixed(1)}</td><td>${t2 % 1 === 0 ? t2 : t2.toFixed(1)}</td><td>${mg.toFixed(1)}</td></tr>`;
  }
  html += `</tbody></table>`;
  return html;
}

function calculate(){
  const inr = parseFloat(document.getElementById('inr').value);
  const weeklyDose = parseFloat(document.getElementById('weeklyDose').value);
  const days = parseInt(document.getElementById('days').value,10);
  const pillChoice = document.querySelector('input[name="pills"]:checked').value;
  const bleed = document.querySelector('input[name="bleed"]:checked').value;
  if(isNaN(inr)||isNaN(weeklyDose)||isNaN(days)){return}

  const resDiv = document.getElementById('results');
  const tables = document.getElementById('tables');
  const plansDiv = document.getElementById('plans');
  const summaryDiv = document.getElementById('summary');

  // ---------- ‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å ----------
  if(bleed === 'yes'){
    resDiv.innerHTML = `<div class="card"><p><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> ‡∏û‡∏ö‡∏†‡∏≤‡∏ß‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å: ‡πÉ‡∏´‡πâ Vit K1 ‡πÅ‡∏•‡∏∞‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏Å‡∏©‡∏≤‡πÄ‡∏â‡∏µ‡∏¢‡∏ö‡∏û‡∏•‡∏±‡∏ô‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡∏ó‡∏¢‡πå</p></div>`;
    resDiv.style.display = 'block';
    tables.style.display = 'none';  // ‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÉ‡∏î‡πÜ
    plansDiv.innerHTML = '';
    summaryDiv.innerHTML = '';
    return;  // ‡∏à‡∏ö‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ‡πÑ‡∏°‡πà‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡πà‡∏≤ Warfarin
  }

  // ---------- ‡∏™‡πà‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏õ‡∏Å‡∏ï‡∏¥ ----------
  let adj = {minPct:0,maxPct:0,avgPct:0,note:''};
  if(inr < 1.5){adj.minPct = 0.10; adj.maxPct = 0.20; adj.avgPct = 0.15; adj.note='‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 10‚Äì20%';}
  else if(inr >=1.5 && inr <=1.9){adj.minPct = 0.05; adj.maxPct = 0.10; adj.avgPct = 0.075; adj.note='‡πÄ‡∏û‡∏¥‡πà‡∏° 5‚Äì10% ‡∏´‡∏£‡∏∑‡∏≠‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÑ‡∏°‡πà‡∏õ‡∏£‡∏±‡∏ö ‡πÅ‡∏ï‡πà‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° INR ‡∏ö‡πà‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô';}
  else if(inr >=2.0 && inr <=3.0){adj.minPct = 0; adj.maxPct = 0; adj.avgPct = 0; adj.note='‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≤';}
  else if(inr >=3.1 && inr <=3.9){adj.minPct = -0.10; adj.maxPct = -0.05; adj.avgPct = -0.075; adj.note='‡∏•‡∏î‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏£‡∏≤‡∏¢‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå 5‚Äì10%';}
  else if(inr >3.9 && inr <5.0){adj.minPct = -0.10; adj.maxPct = -0.10; adj.avgPct = -0.10; adj.note='‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ 1 ‡∏ß‡∏±‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏î‡∏•‡∏á 10%';}
  else if(inr >=5.0 && inr <9.0){adj.minPct = -0.20; adj.maxPct = -0.20; adj.avgPct = -0.20; adj.note='‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ 2 ‡∏ß‡∏±‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏Ç‡∏ô‡∏≤‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏î‡∏•‡∏á 20% ‚Äî ‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤‡πÉ‡∏´‡πâ Vitamin K‚ÇÅ 1‚Äì2.5 mg ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡∏≠‡∏≠‡∏Å';}
  else if(inr >= 9.0){adj.minPct = null; adj.maxPct = null; adj.avgPct = null; adj.note='INR > 9.0: ‡∏´‡∏¢‡∏∏‡∏î‡∏¢‡∏≤ ‡πÉ‡∏´‡πâ Vitamin K‚ÇÅ 2.5‚Äì5 mg ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ó‡∏≤‡∏ô ‡πÅ‡∏•‡∏∞‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° INR ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÉ‡∏Å‡∏•‡πâ‡∏ä‡∏¥‡∏î ‚Äî ‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÅ‡∏û‡∏ó‡∏¢‡πå/‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏±‡∏ö‡∏¢‡∏≤';}

  let newRange = {};
  if(adj.minPct===null){ 
    newRange.note = '‡πÑ‡∏°‡πà‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÉ‡∏´‡πâ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö INR >= 9.0 ‚Äî ‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô'; 
  } else{
    const min = weeklyDose * (1 + adj.minPct);
    const max = weeklyDose * (1 + adj.maxPct);
    const avg = weeklyDose * (1 + adj.avgPct);
    newRange = {
      minCalc: parseFloat(min.toFixed(1)),
      maxCalc: parseFloat(max.toFixed(1)),
      avgCalc: parseFloat(avg.toFixed(1)),
      min: roundHalf(min*2)/2,
      max: roundHalf(max*2)/2,
      avg: roundHalf(avg*2)/2
    };
  }

  let html = `<div class="card">`;
  html += `<p><strong>‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥:</strong> INR = ${inr.toFixed(2)} ‚Äî ${adj.note}</p>`;
  if(newRange.note){ html += `<p class="note">${newRange.note}</p>`; }
  else{
    html += `<p>‡∏Ç‡∏ô‡∏≤‡∏î‡∏¢‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå (mg) [‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏£‡∏¥‡∏á]: <strong>${newRange.minCalc} ‚Äî ${newRange.maxCalc}</strong> (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${newRange.avgCalc} mg)</p>`;
  }
  html += `</div>`;
  resDiv.innerHTML = html; 
  resDiv.style.display='block';

  // ---------- ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á Warfarin ----------
  plansDiv.innerHTML = '';
  summaryDiv.innerHTML = '';
  if(newRange.min !== undefined){
    const targets = [
      {k:'‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î',val:newRange.min},
      {k:'‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢',val:newRange.avg},
      {k:'‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î',val:newRange.max}
    ];
    let summaryData = {min:{},avg:{},max:{}};
    targets.forEach(t=>{
      let best;
      if(pillChoice === '3'){
        const h3 = Math.round((t.val / 1.5));
        best = {h3:h3,h2:0,total:h3*1.5};
      } else if(pillChoice === '2'){
        const h2 = Math.round(t.val / 1.0);
        best = {h3:0,h2:h2,total:h2*1.0};
      } else {
        best = findBestCombo(t.val);
      }
      if(t.k==='‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î'){summaryData.min=best;}
      if(t.k==='‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢'){summaryData.avg=best;}
      if(t.k==='‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î'){summaryData.max=best;}
      plansDiv.innerHTML += buildPlanHTML(t.k, best);
    });

    const min3 = summaryData.min.h3 / 2 * (days / 7);
    const min2 = summaryData.min.h2 / 2 * (days / 7);
    const avg3 = summaryData.avg.h3 / 2 * (days / 7);
    const avg2 = summaryData.avg.h2 / 2 * (days / 7);
    const max3 = summaryData.max.h3 / 2 * (days / 7);
    const max2 = summaryData.max.h2 / 2 * (days / 7);

    const totalMinMg = summaryData.min.total * (days / 7);
    const totalAvgMg = summaryData.avg.total * (days / 7);
    const totalMaxMg = summaryData.max.total * (days / 7);

    summaryDiv.innerHTML = `‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏±‡∏î ${days} ‡∏ß‡∏±‡∏ô\n\n`+
      `‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏ß‡∏° ${min3.toFixed(1)} ‡πÄ‡∏°‡πá‡∏î(3 mg) ‡πÅ‡∏•‡∏∞ ${min2.toFixed(1)} ‡πÄ‡∏°‡πá‡∏î(2 mg) -> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏à‡πà‡∏≤‡∏¢ (‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô): ${Math.ceil(min3)} ‡πÄ‡∏°‡πá‡∏î(3 mg), ${Math.ceil(min2)} ‡πÄ‡∏°‡πá‡∏î(2 mg).\n\n`+
      `‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏ß‡∏° ${avg3.toFixed(1)} ‡πÄ‡∏°‡πá‡∏î(3 mg) ‡πÅ‡∏•‡∏∞ ${avg2.toFixed(1)} ‡πÄ‡∏°‡πá‡∏î(2 mg) -> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏à‡πà‡∏≤‡∏¢ (‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô): ${Math.ceil(avg3)} ‡πÄ‡∏°‡πá‡∏î(3 mg), ${Math.ceil(avg2)} ‡πÄ‡∏°‡πá‡∏î(2 mg).\n\n`+
      `‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î: ‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡∏£‡∏ß‡∏° ${max3.toFixed(1)} ‡πÄ‡∏°‡πá‡∏î(3 mg) ‡πÅ‡∏•‡∏∞ ${max2.toFixed(1)} ‡πÄ‡∏°‡πá‡∏î(2 mg) -> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏°‡πá‡∏î‡∏à‡∏£‡∏¥‡∏á‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏£‡∏à‡πà‡∏≤‡∏¢ (‡∏õ‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô): ${Math.ceil(max3)} ‡πÄ‡∏°‡πá‡∏î(3 mg), ${Math.ceil(max2)} ‡πÄ‡∏°‡πá‡∏î(2 mg).\n\n`+
      `‡∏õ‡∏£‡∏¥‡∏°‡∏≤‡∏ì‡∏£‡∏ß‡∏° (mg): ‡∏ï‡πà‡∏≥‡∏™‡∏∏‡∏î ${totalMinMg.toFixed(1)} mg, ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ${totalAvgMg.toFixed(1)} mg, ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î ${totalMaxMg.toFixed(1)} mg.`;

    summaryDiv.classList.add('note');
    tables.style.display = 'block';
  } else {
    plansDiv.innerHTML = `<div class="note">${newRange.note}</div>`;
    tables.style.display = 'block';
  }
}

// -------------------- Event listeners --------------------
document.querySelectorAll('input[name="pills"]').forEach(el=>el.addEventListener('change', calculate));
document.querySelectorAll('input[name="bleed"]').forEach(el=>el.addEventListener('change', calculate));
document.getElementById('inr').addEventListener('input', calculate);
document.getElementById('weeklyDose').addEventListener('input', calculate);
document.getElementById('days').addEventListener('input', calculate);

// ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å
calculate();
</script>
</body>
</html>
